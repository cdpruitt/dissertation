\documentclass[twosided, 12pt]{book} %twosided is nice requires (sometimes) introduces blank pagestyle, which is cool because it looks nice and lets me make fancy headers
\usepackage{emptypage} % should remove blank page headers and footers, i.e., works beautifully
\usepackage{titlesec} % modify title and section(<-doesn't work?)
\usepackage{amsmath} % lots of math functions
\usepackage{epigraph} % lets me write an epigraph obviously...
\usepackage[super]{nth} % pretty formatting of ordinal numerals
\usepackage{graphicx} % putting in figures, if one might ask..
\usepackage{braket} % Dirac notation
\usepackage{geometry}
\geometry{
    margin = 1in  % give 1in margins
}
\usepackage[font = small]{caption}
\usepackage{verbatim}
\usepackage{appendix}
\usepackage{adjustbox} % adjust figures
\usepackage{tabularx}
\usepackage{indentfirst}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amssymb} % AMS symbol package
\usepackage{amsthm}  % AMS symbol package
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\usepackage[toc]{glossaries} % makeglossaries thesis
\usepackage{afterpage} % very useful for formating...
\usepackage{setspace}
\doublespacing % double spaces whole document except for captions
\usepackage{notoccite}
\usepackage[symbol]{footmisc} % for footnotes with weird characters
\usepackage{afterpage} % needed this for putting things back on track, outlined below
\usepackage{textcomp}
\usepackage{fancyhdr} % allows for fancy headers
\pagestyle{fancy} % uses fancy page styling for headers and such --> change to "plain" if have to get rid of headers
\usepackage{mathtools} % for making NR= sign
\usepackage{upgreek} % for non-italicized Greek letters
\usepackage{pgffor}
\usepackage{float}

\interfootnotelinepenalty=1000 % To make sure footnotes don't get split on a separate page, 10000 is max

\setlength{\textfloatsep}{15pt} % might fix gap between text and figures, and it does!
\setlength{\parskip}{0pt} % might fix gap between paragraphs, and it does!
% now there are some weird gaps between section headings and text

\renewcommand{\chaptermark}[1]{\markboth{#1}{}} %still don't understand how this grabs chapterName but it does...
\renewcommand{\sectionmark}[1]{\markright{#1}} %still don't understand how this grabs sectionName but it does...
\fancyhead{} %clears the fancy header
\fancyhead[LO]{\MakeUppercase{\leftmark}} %Left even header for just saying chaptername

% code below lets me add a blankpage with \afterpage{\blankpage}
\newcommand\blankpage{%
    \null
    \thispagestyle{empty}%
    \addtocounter{page}{-1}%
\newpage}

  % lets me change the type of footnote
\renewcommand{\thefootnote}{\fnsymbol{footnote}}
%\allsectionsfont{\singlespacing} 

% defines shortcuts for common physics symbols
% scattering cross sections
\newcommand{\tot}{\ensuremath{\sigma_{tot}}}
\newcommand{\tots}{\ensuremath{\sigma_{tot}}\,\,}
\newcommand{\totE}{\ensuremath{\sigma_{tot}}(E)}
\newcommand{\totEs}{\ensuremath{\sigma_{tot}}(E)\,\,}
\newcommand{\totRDs}{\ensuremath{\sigma_{A,A'}}(E)\,}
\newcommand{\rxn}{\ensuremath{\sigma_{rxn}}}
\newcommand{\rxnE}{\ensuremath{\sigma_{rxn}}(E)}
\newcommand{\rxnEs}{\ensuremath{\sigma_{rxn}}(E)\,\,}

% nuclides
\newcommand{\oSix}{\ensuremath{^{16}}O}
\newcommand{\oEight}{\ensuremath{^{18}}O}
\newcommand{\caForty}{\ensuremath{^{40}}Ca}
\newcommand{\caEight}{\ensuremath{^{48}}Ca}
\newcommand{\niEight}{\ensuremath{^{58}}Ni}
\newcommand{\niFour}{\ensuremath{^{64}}Ni}
\newcommand{\snTwelve}{\ensuremath{^{112}}Sn}
\newcommand{\snFour}{\ensuremath{^{124}}Sn}
\newcommand{\pbEight}{\ensuremath{^{208}}Pb}

% shell labels
\newcommand{\sOne}{s\ensuremath{\frac{1}{2}}}
\newcommand{\pThree}{p\ensuremath{\frac{3}{2}}}
\newcommand{\pOne}{p\ensuremath{\frac{1}{2}}}
\newcommand{\dFive}{d\ensuremath{\frac{5}{2}}}
\newcommand{\dThree}{d\ensuremath{\frac{3}{2}}}
\newcommand{\fSeven}{f\ensuremath{\frac{7}{2}}}
\newcommand{\fFive}{f\ensuremath{\frac{5}{2}}}

\setlength\epigraphwidth{.8\textwidth}
\setlength\epigraphrule{0pt}

\setlength\headheight{15pt} %fixed fancyhdr problems

% Stuff below manually adjusts chapter titles
\titleformat
{\chapter} % command
[display] % shape
{\bfseries \Large} % format
{Chapter \ \thechapter} % label
{0.1 in} % sep
{
    \rule{\textwidth}{1pt}
    \vspace{0.1in}
    % \centering
    \raggedleft
} % before-code
[
    \vspace{-0.25in}%
    \rule{\textwidth}{1pt}
] % after-code

\titleformat*{\section}{\large\bfseries}
\titleformat*{\subsection}{\normalsize\bfseries}

%gives me a lambdabar command below
\makeatletter
\newcommand{\lambdabar}{{\mathchoice
    {\smash@bar\textfont\displaystyle{0.25}{1.2}\lambda}
    {\smash@bar\textfont\textstyle{0.25}{1.2}\lambda}
    {\smash@bar\scriptfont\scriptstyle{0.25}{1.2}\lambda}
    {\smash@bar\scriptscriptfont\scriptscriptstyle{0.25}{1.2}\lambda}
}}
\newcommand{\smash@bar}[4]{%
    \smash{\rlap{\raisebox{-#3\fontdimen5#10}{$\m@th#2\mkern#4mu\mathchar'26$}}}%
}
\makeatother

\newcommand{\textDirectory}{text}

\input{\textDirectory/glossary}

\begin{document}

\frontmatter

\input{\textDirectory/titlepage}

\begingroup
\let\cleardoublepage\clearpage
\tableofcontents
\endgroup

\fancyhead{}
\fancyhead[LO]{\MakeUppercase{\leftmark}}

\begingroup
\let\cleardoublepage\clearpage
\addcontentsline{toc}{chapter}{List of Figures}
\listoffigures
\endgroup

\clearpage

\fancyhead{}
\fancyhead[LO]{\MakeUppercase{\leftmark}}

\begingroup
\let\cleardoublepage\clearpage
\addcontentsline{toc}{chapter}{List of Tables}
\listoftables
\endgroup

\clearpage
\addcontentsline{toc}{chapter}{Acknowledgements}
\fancyhead{}
\fancyhead[LO]{\MakeUppercase{Acknowledgements}} %Left even header

\begingroup
\let\cleardoublepage\clearpage
\chapter*{Acknowledgements}
\input{\textDirectory/acknowledgements}
\endgroup

%\clearpage
\input{\textDirectory/abstract}
\addcontentsline{toc}{chapter}{Abstract}

\afterpage{\blankpage}
\clearpage

\mainmatter

\fancyhead{} %clears the header
\fancyhead[RO]{\MakeUppercase{chapter \thechapter \ \leftmark}} %Right odd header
\fancyhead[LE]{\MakeUppercase{\rightmark}} %Left even header

\chapter{Introduction} \label{introduction}
\input{\textDirectory/introduction}

\chapter{Dispersive Optical Model Formalism} \label{DOMFormalism}
\input{\textDirectory/DOMFormalism}

%\chapter{Neutron Scattering And Detection Techniques} \label{Techniques}
%\input{\textDirectory/techniques}
%
%\chapter{Neutron Total Cross Sections: Experiment} \label{TCSExperiment}
%\input{\textDirectory/TCSExperiment}
%
%\chapter{Neutron Total Cross Sections: Analysis and Results} \label{TCSAnalysis}
%\input{\textDirectory/TCSAnalysis}
%
%\chapter{Neutron Elastic Cross Sections: Experiment} \label{ECSExperiment}
%\input{\textDirectory/ECSExperiment}
%
%\chapter{Neutron Elastic Cross Sections: Analysis and Results} \label{ECSAnalysis}
%\input{\textDirectory/ECSAnalysis}
%
%\chapter{Dispersive Optical Model Results}\label{DOMResults}
%\input{\textDirectory/DOMResults}
%
%\chapter{Conclusion}
%\input{\textDirectory/conclusion}

\clearpage %needed this or for some reason the header writes appendix for the last chapter...

\fancyhead{} %clears the header
\fancyhead[LE]{\MakeUppercase{ \leftmark}} %rewrite fancy header to just label chapter name

\clearpage
\addcontentsline{toc}{chapter}{Bibliography}

\singlespacing
\bibliographystyle{unsrt}
\bibliography{references}
\doublespacing

\clearpage

\begin{appendices}

  %Reformat chapter titles so that they say appendix in the appendices
    \titleformat
    {\chapter} % command
    [display] % shape
    {\bfseries \Large} % format
    {Appendix \ \thechapter} % label %Here is where I write appendix, also \ moves you a space or two
    {0.1 in} % sep
    {
        \rule{\textwidth}{1pt}
        \vspace{0.2in}
    % \centering
        \raggedleft
    } % before-code
    [
        \vspace{-0.3in}%
        \rule{\textwidth}{1pt}
    ] % after-code
    \titlespacing*{\chapter}{0pt}{-22pt}{0pt}

    %\fancyhead{} %clears the header
    %\fancyhead[RO]{\MakeUppercase{appendix \thechapter \ \leftmark}} %rewrite fancy header to say appendix
    %\chapter{DOM Fit Results}
    %\input{\textDirectory/fits}
    %\addcontentsline{toc}{chapter}{DOM Fit Parameters}

    %\fancyhead{} %clears the header
    %\fancyhead[RO]{\MakeUppercase{appendix \thechapter \ \leftmark}} %rewrite fancy header to say appendix
    %\chapter{DOM Fit Parameters}
    %\input{\textDirectory/parameters}
    %\addcontentsline{toc}{chapter}{DOM Fit Parameters}

    %\chapter{Literature data used in DOM Fits}
    %\input{\textDirectory/dataSets}
    %\addcontentsline{toc}{chapter}{Literature Data used in DOM Fits}

    %\chapter*{Physical Constants}
    %\input{\textDirectory/units}
    %\addcontentsline{toc}{chapter}{Physical Constants}

\end{appendices}

\fancyhead{} %clears the header
\fancyhead[LE]{\MakeUppercase{ \leftmark}} %rewrite fancy header to say appendix

\printglossary

\end{document}
